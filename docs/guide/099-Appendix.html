<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Appendix | TrinketTinker </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Appendix | TrinketTinker ">
      
      
      <link rel="icon" href="../images/favicon.png">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Mushymato/TrinketTinker/blob/main/guide/099-Appendix.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/favicon.png" alt="TrinketTinker">
            TrinketTinker
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="appendix">Appendix</h1>

<p>A.k.a the section where the author go on and on out about design choices and other info of -2 relevance to actually using this framework. If you are not a nerd you can stop reading here.</p>
<p>The designed layed out here pertains specifically to Trinket Tinker. It is not the sole answer to extending trinkets, or sole answer to a system of companions. It would be very cool to see other framework mods implement their own flavor of trinkets/companions.</p>
<h2 id="features-that-made-this-mod-viable">Features that made this mod Viable</h2>
<p>Trinkets are cool 1.6 feature indeed, but it has some special traits that makes it a far easier to extend than previous game systems that described equipment: the (ab)use of reflection to fetch a <code>TrinketEffectClass</code> that drives the actual functionality of a trinket. This degree of separation is vital because <code>TrinketEffectClass</code> is never serialized to the save file, making it safe to subclass. This is why Trinket Tinker does not need Harmony (the library used to modify game code), as it can simply politely &quot;ask&quot; the game to use it's code by presenting a custom <code>TrinketEffectClass</code> to be fetched by reflection.</p>
<p>Besides the effect class, another convenient entity is the <code>StardewValley.Companions.Companion</code> class. It is a lightweight class that does not descend from <code>Characters</code> but still implememnts <code>INetObject&lt;NetFields&gt;</code> and carry info about which player owns it and what position in the world it's currently at. Through subclassing <code>Companion</code>, Trinket Tinker has access to net fields without taking on the burden of the entire <code>Characters</code> class, and get free netsync'd position out of it. It too is never serialized to the save (although there are some persistent problems with duplicate vanilla companions).</p>
<h2 id="scheme">Scheme</h2>
<p>The two core features of a trinket is <code>Motion</code>, which represents the companion and how it moves, and <code>Abilities</code> which represents what it does. All other kinds of data are auxiliary and simply serve one or both of these features. Although they are &quot;core&quot;, both features are optional in a way: you can have a trinket that has no abilities and only a companion follower, and you can have a trinket that has no companions but still activate abilities as usual.</p>
<h3 id="motion">Motion</h3>
<p>Because there's no assumption about the intended purpose of the trinket companion, the <code>Motion</code> (and it's supplemental data in <code>Variants</code>) is very flexible and imposes only a few rules about how the sprite sheet should be structured. Initially, this framework is geared towards creating non-human critters with entirely custom sprite sheets. As the usecase of a NPC-esque companion came up, features were added later to help support asset reuse and pretending to be an NPC. Another emergent feature is <code>AnimClips</code> which was added on after the default motion modes were finalized, but if this framework were to be redone, <code>AnimClips</code> is perhaps the preferable way of defining animations in general as it describes animations explictly, rather than rely on magic implict rules that require an entire documentation page to explain. Even in current version it is completely possible to create a companion that only has motion via <code>AnimClips</code>.</p>
<p>A notable choice is the absense of true collision, this is because I played enough skyrim to see the followers get stuck on 1cm ledges. Collision will never be truly real for trinket tinker, because the path finder of stardew is both very cursed and grid based while the player does not move along grids. The design choice made here is that the companion is considered an extension of the farmer rather than their own entity, and this is reflected in how they act and how abilities work at all.</p>
<h3 id="abilities">Abilities</h3>
<p>The ability system is essentially a live and fast acting version of <code>Data/TriggerActions</code> that only activates when trinket is equipped. The mod comes with pre-defined set of abilities to use based on the initial goal of &quot;replicate most if not all vanilla trinkets&quot; and a number of useful shared behaviors that ride along with the ability's activation (Proc* fields). It is another beneficiary of 1.6: many useful bits of code are now usable anywhere via Game State Queries and Trigger Action Actions, and now it becomes quite easy for one mod to define custom behavior that other mods can leverage. In Trinket Tinker this takes the form of the <code>&quot;Action&quot;</code> ability class to run arbitrary Trigger Action Actions with, and the <code>&quot;Condition&quot;</code> fields provided in a number of places that can be controlled via Game State Queries.</p>
<p>As for why this feature doesn't just apply <code>Data/TriggerActions</code>, it is simply because I did not know that system very well when I drafted Trinket Tinker back in July 2024. Still, there are benefits to having this separate system in that I can organize things logically and locally per trinket and it was straightforward to open integration to triggers and trigger actions later on.</p>

</article>


        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <a href="https://github.com/Mushymato/TrinketTinker">Source</a>   <a href="https://www.nexusmods.com/stardewvalley/mods/29073">Nexus</a>
        </div>
      </div>
    </footer>
  </body>
</html>
